// Import the required packages
const { Builder, By, Key, until } = require('selenium-webdriver');

// Function to inject search terms using Selenium
async function injectSearchTerms(searchTerms, entryLevel, cityState, distance, country, timePosted, remote) {
  const driver = await new Builder().forBrowser('chrome').build();

  try {
    await driver.get('https://www.linkedin.com/jobs/search/?currentJobId=*');

    // Inject search terms
    await driver.findElement(By.id('jobs-search-box-keyword-id-ember26')).sendKeys(searchTerms, Key.RETURN);

    // Select entry level
    if (entryLevel) {
      await driver.findElement(By.id('searchFilter_experience')).click();
      await driver.findElement(By.xpath('//span[text()="Entry level"]')).click();
    }

    // Inject city/state or country
    if (cityState) {
      await driver.findElement(By.id('jobs-search-box-location-id-ember26')).sendKeys(cityState, Key.RETURN);
    } else if (country) {
      await driver.findElement(By.id('jobs-search-box-location-id-ember26')).sendKeys(country, Key.RETURN);
    }

    // Inject distance if applicable
    if (distance) {
      await driver.findElement(By.id('ember163')).click();
      await driver.findElement(By.xpath(`//span[text()="${distance} mi"]`)).click();
    }

    // Inject time posted
    await driver.findElement(By.id('searchFilter_timePostedRange')).click();
    await driver.findElement(By.xpath(`//span[text()="${timePosted}"]`)).click();

    // Inject remote option
    if (remote) {
      await driver.findElement(By.id('searchFilter_workplaceType')).click();
      await driver.findElement(By.xpath(`//span[text()="${remote}"]`)).click();
    }

    // Click the search button
    await driver.findElement(By.id('searchButton')).click();

    // Wait for the search results to load
    await driver.wait(until.elementLocated(By.css('.search-results')), 10000);
  } finally {
    // Quit the driver when done
    await driver.quit();
  }
}

// Event listener for search button
searchButton.addEventListener('click', async function () {
  injectSearchTerms(searchTerms, entryLevel, cityStateValue, distance, country, timePosted, remote);
});
